<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .summary-card.total-sales {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .summary-card.total-items {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .summary-card h3 {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .summary-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-control {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        input, select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .stock-low {
            color: #f5576c;
            font-weight: bold;
        }

        .stock-ok {
            color: #43e97b;
            font-weight: bold;
        }

        .delete-btn {
            background: linear-gradient(135deg, #f5576c 0%, #ff6b6b 100%);
            padding: 8px 15px;
            font-size: 0.9em;
            box-shadow: 0 2px 10px rgba(245, 87, 108, 0.4);
        }

        .price-btn {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            padding: 8px 15px;
            font-size: 0.9em;
            box-shadow: 0 2px 10px rgba(255, 167, 38, 0.4);
            margin: 0 3px;
        }

        .add-stock-btn {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            padding: 8px 15px;
            font-size: 0.9em;
            box-shadow: 0 2px 10px rgba(67, 233, 123, 0.4);
            margin: 0 3px;
        }

        .edit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 15px;
            font-size: 0.9em;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
            margin: 0 3px;
        }

        .edit-stock-btn {
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            padding: 8px 15px;
            font-size: 0.9em;
            box-shadow: 0 2px 10px rgba(0, 180, 219, 0.4);
            margin: 0 3px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .price-change {
            font-size: 0.85em;
            padding: 3px 8px;
            border-radius: 5px;
            margin-left: 5px;
        }

        .price-increase {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .price-decrease {
            background: #ffebee;
            color: #c62828;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .summary-card .value {
                font-size: 2em;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px;
            }

            button {
                padding: 10px 15px;
                font-size: 0.85em;
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <p>‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <div class="content">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card total-sales">
                    <h3>üí∞ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="value" id="todaySales">‡∏ø0</div>
                </div>
                <div class="summary-card total-items">
                    <h3>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="value" id="totalStock">0</div>
                </div>
                <div class="summary-card">
                    <h3>üõçÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="value" id="todayTransactions">0</div>
                </div>
            </div>

            <!-- Add New Product -->
            <div class="section">
                <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
                <form id="addProductForm">
                    <div class="form-group">
                        <div class="form-control">
                            <label for="newProductName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="newProductName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required>
                        </div>
                        <div class="form-control">
                            <label for="newProductPrice">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                            <input type="number" id="newProductPrice" min="0" step="0.01" placeholder="0.00" required>
                        </div>
                        <div class="form-control">
                            <label for="newProductStock">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</label>
                            <input type="number" id="newProductStock" min="0" placeholder="0" required>
                        </div>
                    </div>
                    <button type="submit">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </form>
            </div>

            <!-- Product Stock Management -->
            <div class="section">
                <h2>üìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <table id="stockTable">
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            <th>‡∏•‡∏ö</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody">
                    </tbody>
                </table>
            </div>

            <!-- Add Sale -->
            <div class="section">
                <h2>üõí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                <form id="saleForm">
                    <div class="form-group">
                        <div class="form-control">
                            <label for="productSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="productSelect" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <label for="quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                            <input type="number" id="quantity" min="1" required>
                        </div>
                        <div class="form-control">
                            <label for="saleDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                            <input type="date" id="saleDate" required>
                        </div>
                    </div>
                    <button type="submit">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                </form>
            </div>

            <!-- Sales History -->
            <div class="section">
                <h2>üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                <div class="date-filter">
                    <div class="form-control">
                        <label for="filterDate">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="filterDate">
                    </div>
                    <button onclick="filterSales()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    <button onclick="clearFilter()">üîÑ ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
                <br>
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ø)</th>
                            <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ø)</th>
                            <th>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Initialize products with default data
        let products = [
            { id: 1, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A", price: 100, stock: 50, priceHistory: [{price: 100, date: new Date().toISOString()}] },
            { id: 2, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B", price: 150, stock: 30, priceHistory: [{price: 150, date: new Date().toISOString()}] },
            { id: 3, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ C", price: 200, stock: 40, priceHistory: [{price: 200, date: new Date().toISOString()}] },
            { id: 4, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ D", price: 120, stock: 25, priceHistory: [{price: 120, date: new Date().toISOString()}] },
            { id: 5, name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ E", price: 180, stock: 35, priceHistory: [{price: 180, date: new Date().toISOString()}] }
        ];

        let sales = [];

        // Load data from localStorage if available
        function loadData() {
            const savedProducts = localStorage.getItem('products');
            const savedSales = localStorage.getItem('sales');
            
            if (savedProducts) {
                products = JSON.parse(savedProducts);
                // Ensure priceHistory exists for older data
                products.forEach(p => {
                    if (!p.priceHistory) {
                        p.priceHistory = [{price: p.price, date: new Date().toISOString()}];
                    }
                });
            }
            if (savedSales) {
                sales = JSON.parse(savedSales);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('sales', JSON.stringify(sales));
        }

        // Set today's date as default
        document.getElementById('saleDate').valueAsDate = new Date();

        // Render stock table
        function renderStockTable() {
            const tbody = document.getElementById('stockTableBody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = tbody.insertRow();
                
                // Check if price changed recently
                let priceChangeHtml = '';
                if (product.priceHistory && product.priceHistory.length > 1) {
                    const previousPrice = product.priceHistory[product.priceHistory.length - 2].price;
                    const currentPrice = product.price;
                    const change = currentPrice - previousPrice;
                    const changePercent = ((change / previousPrice) * 100).toFixed(1);
                    
                    if (change !== 0) {
                        const changeClass = change > 0 ? 'price-increase' : 'price-decrease';
                        const changeSymbol = change > 0 ? '‚ñ≤' : '‚ñº';
                        priceChangeHtml = `<span class="price-change ${changeClass}">${changeSymbol} ${Math.abs(changePercent)}%</span>`;
                    }
                }
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>‡∏ø${product.price.toLocaleString()}${priceChangeHtml}</td>
                    <td class="${product.stock < 20 ? 'stock-low' : 'stock-ok'}">
                        ${product.stock} ${product.stock < 20 ? '‚ö†Ô∏è ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥' : '‚úÖ'}
                    </td>
                    <td>
                        <button class="add-stock-btn" onclick="addStock(${product.id})">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                        <button class="edit-stock-btn" onclick="editStock(${product.id})">üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                        <button class="price-btn" onclick="adjustPrice(${product.id})">üí∞ ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                        <button class="edit-btn" onclick="editProduct(${product.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠</button>
                    </td>
                    <td>
                        <button class="delete-btn" onclick="deleteProduct(${product.id})">üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    </td>
                `;
            });

            updateProductSelect();
            updateSummary();
        }

        // Update product select dropdown
        function updateProductSelect() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>';
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (‡∏ø${product.price}) - ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${product.stock}`;
                if (product.stock === 0) {
                    option.disabled = true;
                    option.textContent += ' [‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î]';
                }
                select.appendChild(option);
            });
        }

        // Add stock to product
        function addStock(productId) {
            const product = products.find(p => p.id === productId);
            const amount = prompt(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${product.name}\n‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°:`, '10');
            
            if (amount && !isNaN(amount) && parseInt(amount) > 0) {
                product.stock += parseInt(amount);
                saveData();
                renderStockTable();
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å ${product.name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${amount} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        // Edit stock directly
        function editStock(productId) {
            const product = products.find(p => p.id === productId);
            const currentStock = product.stock;
            
            const newStock = prompt(
                `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${product.name}\n\n‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${currentStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà:`, 
                currentStock
            );
            
            if (newStock === null) return; // User cancelled
            
            if (newStock === '' || isNaN(newStock) || parseInt(newStock) < 0) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0 ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤)');
                return;
            }
            
            const stock = parseInt(newStock);
            const oldStock = product.stock;
            
            if (stock === oldStock) {
                alert('‚ÑπÔ∏è ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á');
                return;
            }
            
            // Update stock
            product.stock = stock;
            saveData();
            renderStockTable();
            
            const change = stock - oldStock;
            const changeText = change > 0 
                ? `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${change} ‡∏´‡∏ô‡πà‡∏ß‡∏¢` 
                : `‡∏•‡∏î‡∏•‡∏á ${Math.abs(change)} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;
            
            alert(`‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ï‡πá‡∏≠‡∏Å ${product.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡πà‡∏≤: ${oldStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n${changeText}`);
        }

        // Adjust product price
        function adjustPrice(productId) {
            const product = products.find(p => p.id === productId);
            const currentPrice = product.price;
            
            const newPrice = prompt(
                `‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${product.name}\n\n‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ‡∏ø${currentPrice}\n‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà:`, 
                currentPrice
            );
            
            if (newPrice && !isNaN(newPrice) && parseFloat(newPrice) > 0) {
                const oldPrice = product.price;
                const price = parseFloat(newPrice);
                
                if (price === oldPrice) {
                    alert('‚ÑπÔ∏è ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á');
                    return;
                }
                
                // Update price and add to history
                product.price = price;
                if (!product.priceHistory) {
                    product.priceHistory = [];
                }
                product.priceHistory.push({
                    price: price,
                    date: new Date().toISOString()
                });
                
                saveData();
                renderStockTable();
                renderSalesTable();
                
                const change = price - oldPrice;
                const changePercent = ((change / oldPrice) * 100).toFixed(1);
                const changeText = change > 0 ? `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${changePercent}%` : `‡∏•‡∏î‡∏•‡∏á ${Math.abs(changePercent)}%`;
                
                alert(`‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤ ${product.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏Å‡πà‡∏≤: ‡∏ø${oldPrice}\n‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà: ‡∏ø${price}\n${changeText}`);
            }
        }

        // Edit product
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            const newName = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:', product.name);
            if (newName && newName.trim() !== '') {
                product.name = newName.trim();
            }
            
            saveData();
            renderStockTable();
            renderSalesTable();
        }

        // Add new product
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('newProductName').value.trim();
            const price = parseFloat(document.getElementById('newProductPrice').value);
            const stock = parseInt(document.getElementById('newProductStock').value);
            
            if (!name) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            if (price < 0) {
                alert('‚ùå ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏ß‡∏Å');
                return;
            }
            
            if (stock < 0) {
                alert('‚ùå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏ß‡∏Å‡∏´‡∏£‡∏∑‡∏≠ 0');
                return;
            }
            
            // Check for duplicate name
            const existingProduct = products.find(p => p.name.toLowerCase() === name.toLowerCase());
            if (existingProduct) {
                if (!confirm(`‚ö†Ô∏è ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠ "${name}" ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ã‡πâ‡∏≥‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    return;
                }
            }
            
            // Create new product
            const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
            const newProduct = {
                id: newId,
                name: name,
                price: price,
                stock: stock,
                priceHistory: [{price: price, date: new Date().toISOString()}]
            };
            
            products.push(newProduct);
            saveData();
            renderStockTable();
            
            // Reset form
            this.reset();
            
            alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏ä‡∏∑‡πà‡∏≠: ${name}\n‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø${price.toLocaleString()}\n‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
        });

        // Delete product
        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            
            // Check if product has sales history
            const productSales = sales.filter(s => s.productId === productId);
            
            if (productSales.length > 0) {
                const confirmMsg = `‚ö†Ô∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ "${product.name}" ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${productSales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n‡∏ñ‡πâ‡∏≤‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏î‡πâ‡∏ß‡∏¢\n\n‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
                if (!confirm(confirmMsg)) {
                    return;
                }
                
                // Remove all sales of this product
                sales = sales.filter(s => s.productId !== productId);
            } else {
                if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ "${product.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    return;
                }
            }
            
            // Remove product
            products = products.filter(p => p.id !== productId);
            
            saveData();
            renderStockTable();
            renderSalesTable();
            
            alert(`‚úÖ ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ "${product.name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
        }

        // Handle sale form submission
        document.getElementById('saleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productId = parseInt(document.getElementById('productSelect').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const saleDate = document.getElementById('saleDate').value;
            
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            if (quantity > product.stock) {
                alert(`‚ùå ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${product.stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
                return;
            }
            
            // Add sale
            const sale = {
                id: Date.now(),
                productId: product.id,
                productName: product.name,
                quantity: quantity,
                price: product.price,
                total: quantity * product.price,
                date: saleDate
            };
            
            sales.push(sale);
            product.stock -= quantity;
            
            saveData();
            renderStockTable();
            renderSalesTable();
            
            // Reset form
            this.reset();
            document.getElementById('saleDate').valueAsDate = new Date();
            
            alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏Ç‡∏≤‡∏¢ ${product.name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡∏ø${sale.total.toLocaleString()}`);
        });

        // Render sales table
        function renderSalesTable(filteredSales = null) {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            const salesToShow = filteredSales || sales;
            const sortedSales = [...salesToShow].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sortedSales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</td></tr>';
                return;
            }
            
            sortedSales.forEach(sale => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(sale.date).toLocaleDateString('th-TH')}</td>
                    <td>${sale.productName}</td>
                    <td>${sale.quantity}</td>
                    <td>‡∏ø${sale.price.toLocaleString()}</td>
                    <td><strong>‡∏ø${sale.total.toLocaleString()}</strong></td>
                    <td><button class="delete-btn" onclick="deleteSale(${sale.id})">üóëÔ∏è ‡∏•‡∏ö</button></td>
                `;
            });
        }

        // Delete sale
        function deleteSale(saleId) {
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            
            const sale = sales.find(s => s.id === saleId);
            const product = products.find(p => p.id === sale.productId);
            
            // Return stock
            if (product) {
                product.stock += sale.quantity;
            }
            
            // Remove sale
            sales = sales.filter(s => s.id !== saleId);
            
            saveData();
            renderStockTable();
            renderSalesTable();
            alert('‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
        }

        // Update summary
        function updateSummary() {
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales.filter(s => s.date === today);
            
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const totalStock = products.reduce((sum, product) => sum + product.stock, 0);
            
            document.getElementById('todaySales').textContent = `‡∏ø${todayTotal.toLocaleString()}`;
            document.getElementById('totalStock').textContent = totalStock.toLocaleString();
            document.getElementById('todayTransactions').textContent = todaySales.length;
        }

        // Filter sales by date
        function filterSales() {
            const filterDate = document.getElementById('filterDate').value;
            if (!filterDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }
            
            const filtered = sales.filter(s => s.date === filterDate);
            renderSalesTable(filtered);
        }

        // Clear filter
        function clearFilter() {
            document.getElementById('filterDate').value = '';
            renderSalesTable();
        }

        // Initialize
        loadData();
        renderStockTable();
        renderSalesTable();
    </script>
</body>
</html>